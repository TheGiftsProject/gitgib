<html>
<head>
  <script src="jquery.min.js" type="text/javascript"></script>
  <script src="gitgib_base.js" type="text/javascript"></script>
  <script src="http://gitgib.herokuapp.com/socket.io/socket.io.js"></script>
  <script>
    var gitgib;
    chrome.extension.onConnect.addListener(function (port) {
      console.assert(port.name == "gitgib");
      gitgib = new GitGib();
      port.onMessage.addListener(function (msg) {
        for (i in msg.anchors) {
          var anchor = msg.anchors[i];
          var isRepo = msg.isRepo || false;
          getScore(anchor, isRepo, function (anchor, score, isRepo) {
            port.postMessage({index: anchor.index, score: score, isRepo: isRepo});
          });
        }
      });
    });

    function getScore(anchor, isRepo, cb) {
      gitgib.getScore(anchor.url, isRepo, function (score) {
        cb(anchor, score, isRepo);
      });
    }
  </script>
</head>
</html>
