<html>
    <head>
        <script src="jquery.min.js" type="text/javascript"></script>
        <script>
            var finishedScript;
            var injectCode = '';

            function inject(tab) {
                chrome.tabs.executeScript(tab.tabId, { code: injectCode });
            }

            $.when($.ajax("jquery.min.js", { type: "text" }),
                   $.ajax("url.js", { type: "text" }),
                   $.ajax("githubapi.js", { type: "text" }),
                   $.ajax("pagerank.js", { type: "text" }),
                   $.ajax("script.js", { type: "text" })).done( function(jquery, url, githubapi, pagerank, script) {
                       finishedScript = jquery[0] + url[0] + githubapi[0] + pagerank[0] + script[0];
                       injectCode += "var blarg = document.createElement('script');";
                       injectCode += "blarg.innerHTML = unescape('" + escape(finishedScript) + "');";
                       injectCode += "document.body.appendChild(blarg);";
                   });

            chrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {
                if (changeInfo.status == "complete") {
                    inject(tab);
                }
            });
        </script>
    </head>
</html>
